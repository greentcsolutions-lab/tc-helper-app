{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/universal/extractor.schema.json",
  "title": "Universal U.S. Real Estate Transaction Extraction (Per-Page)",
  "description": "Version 3.0.0 - 2025-12-30 - FIXED: Property address now mandatory with pattern validation",
  "type": "array",
  "minItems": 1,
  "items": {
    "type": "object",
    "properties": {
      "pageNumber": {
        "type": "integer",
        "minimum": 1,
        "description": "PDF page number"
      },
      "pageLabel": {
        "type": "string",
        "description": "Label from classifier (e.g., 'RPA PAGE 1 - TRANSACTION TERMS')"
      },
      "formCode": {
        "type": "string",
        "description": "Form identifier (RPA, SCO, TREC 20-16, FAR/BAR-6, etc.)"
      },
      "formPage": {
        "type": ["integer", "null"],
        "description": "Page within form (e.g., 1 of 17)"
      },
      "pageRole": {
        "type": "string",
        "enum": ["main_contract", "counter_offer", "addendum", "signatures", "broker_info"],
        "description": "Role of this page in the transaction"
      },
      "buyerNames": {
        "type": ["array", "null"],
        "items": { "type": "string", "minLength": 1 },
        "minItems": 1,
        "maxItems": 6,
        "description": "Buyer name(s) as written on this page"
      },
      "sellerNames": {
        "type": ["array", "null"],
        "items": { "type": "string" },
        "minItems": 1,
        "maxItems": 6,
        "description": "Seller name(s) if visible on this page (OPTIONAL - may only be in signatures)"
      },
      "propertyAddress": {
        "type": ["string", "null"],
        "minLength": 10,
        "description": "CRITICAL MANDATORY FIELD: Full property address including street, city, state, ZIP. Format: 'Street Address, City, ST 12345'. This field appears on 95% of real estate pages - check page headers, body sections, and 'Re:' lines. Only return null for pure signature/blank pages with no property reference anywhere. Common locations: (1) Page header table/label, (2) First section of main body, (3) 'Re:' line on counter offers/addenda. Example: '123 Main Street, Los Angeles, CA 90210'. DO NOT extract buyer/seller personal addresses - only the PROPERTY being sold."
      },
      "purchasePrice": {
        "type": ["number", "null"],
        "minimum": 0,
        "description": "Final accepted purchase/sales price in USD (DO NOT return 0 unless truly $0)"
      },
      "earnestMoneyDeposit": {
        "type": ["object", "null"],
        "properties": {
          "amount": { "type": ["number", "null"], "description": "Deposit amount in USD" },
          "holder": { "type": ["string", "null"], "description": "Escrow/title company holding deposit" }
        },
        "description": "Initial/earnest money deposit details"
      },
      "closingDate": {
        "oneOf": [
          { "type": "string", "description": "YYYY-MM-DD if specific date OR text like '45 days'" },
          { "type": "integer", "description": "Days after acceptance (e.g., 45)" },
          { "type": "null" }
        ],
        "description": "Close of escrow/closing date - accept as-is from document"
      },
      "financing": {
        "type": ["object", "null"],
        "properties": {
          "isAllCash": { "type": ["boolean", "null"] },
          "loanType": {
            "type": ["string", "null"],
            "enum": ["Conventional", "FHA", "VA", "USDA", "Other", null],
            "description": "Primary loan type if financed"
          },
          "loanAmount": { "type": ["number", "null"] }
        },
        "description": "Financing terms â€“ isAllCash true if no loan"
      },
      "contingencies": {
        "type": ["object", "null"],
        "properties": {
          "inspectionDays": {
            "oneOf": [
              { "type": "integer", "description": "Days after acceptance" },
              { "type": "string", "description": "e.g., 'Waived' or '2025-12-31'" },
              { "type": "null" }
            ]
          },
          "appraisalDays": {
            "oneOf": [
              { "type": "integer" },
              { "type": "string" },
              { "type": "null" }
            ]
          },
          "loanDays": {
            "oneOf": [
              { "type": "integer" },
              { "type": "string" },
              { "type": "null" }
            ]
          },
          "saleOfBuyerProperty": { "type": ["boolean", "null"], "description": "COP contingency present" }
        },
        "description": "Major contingencies"
      },
      "closingCosts": {
        "type": ["object", "null"],
        "properties": {
          "buyerPays": { "type": ["array", "null"], "items": { "type": "string" }, "description": "e.g., ['title', 'escrow']" },
          "sellerPays": { "type": ["array", "null"], "items": { "type": "string" } },
          "sellerCreditAmount": { "type": ["number", "null"], "description": "Seller credit/concession in USD" }
        },
        "description": "Allocation of closing costs"
      },
      "brokers": {
        "type": ["object", "null"],
        "properties": {
          "listingBrokerage": { "type": ["string", "null"] },
          "listingAgent": { "type": ["string", "null"] },
          "sellingBrokerage": { "type": ["string", "null"] },
          "sellingAgent": { "type": ["string", "null"] }
        },
        "description": "Listing and selling broker/agent names"
      },
      "personalPropertyIncluded": {
        "type": ["array", "null"],
        "items": { "type": "string" },
        "description": "Appliances/fixtures explicitly included (empty array if none specified)"
      },
      "effectiveDate": {
        "type": ["string", "null"],
        "format": "date",
        "description": "Final acceptance/effective date (YYYY-MM-DD) from signature pages"
      },
      "escrowHolder": {
        "type": ["string", "null"],
        "description": "Escrow or title company name"
      },
      "confidence": {
        "type": "object",
        "properties": {
          "overall": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100,
            "description": "Overall confidence for this page's extraction (0-100)"
          },
          "fieldScores": {
            "type": ["object", "null"],
            "additionalProperties": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100
            },
            "description": "Optional per-field confidence breakdown - use for low-confidence fields to trigger second-turn"
          }
        },
        "required": ["overall"],
        "description": "Confidence scoring - if overall < 80 or propertyAddress confidence < 70, second-turn extraction will be triggered"
      }
    },
    "required": [
      "pageNumber",
      "pageLabel",
      "formCode",
      "pageRole",
      "confidence"
    ],
    "additionalProperties": false
  }
}