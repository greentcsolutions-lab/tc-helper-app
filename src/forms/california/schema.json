{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "California RPA â€“ TC Core Fields",
  "description": "Version 2.0.0 - 2025-01-09 - Updated to match CategorySection components exactly",
  "type": "object",
  "properties": {
    "buyer_names": {
      "description": "Section 1.A - All buyer names exactly as written",
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    
    "property_address": {
      "description": "Section 1.B",
      "type": "object",
      "properties": {
        "full": { "type": "string" }
      },
      "required": ["full"]
    },
    
    "purchase_price": {
      "description": "Section 3.A, Columns 2-4",
      "type": "string",
      "pattern": "^\\$\\d{1,3}(,\\d{3})*(\\.\\d{2})?$"
    },
    
    "all_cash": {
      "description": "Section 3.A, Column 5 checkbox",
      "type": "boolean"
    },
    
    "close_of_escrow": {
      "description": "Section 3.B, Column 4 - Days after acceptance OR specific date",
      "oneOf": [
        { "type": "integer", "minimum": 1 },
        { "type": "string", "pattern": "^(0[1-9]|1[0-2])\\/(0[1-9]|[12]\\d|3[01])\\/\\d{4}$" }
      ]
    },
    
    "initial_deposit": {
      "description": "Section 3.D(1)",
      "type": "object",
      "properties": {
        "amount": {
          "description": "Column 4 - Dollar amount or percentage",
          "type": "string",
          "pattern": "^(\\$\\d{1,3}(,\\d{3})*(\\.\\d{2})?|\\d+(\\.\\d+)?%)$"
        },
        "due": {
          "description": "Column 5 - Days after acceptance OR specific date",
          "oneOf": [
            { "type": "integer", "minimum": 0 },
            { "type": "string", "pattern": "^(0[1-9]|1[0-2])\\/(0[1-9]|[12]\\d|3[01])\\/\\d{4}$" }
          ]
        }
      },
      "required": ["amount"]
    },
    
    "loan_type": {
      "description": "Section 3.E(1), Column 5 - Null if all_cash is true",
      "type": ["string", "null"],
      "enum": ["Conventional", "FHA", "VA", "Seller Financing", "Other", "Assumable", null]
    },
    
    "seller_credit_to_buyer": {
      "description": "Section 3.G(1) - Checkbox Column 3, Amount Column 4",
      "type": ["string", "null"],
      "pattern": "^\\$\\d{1,3}(,\\d{3})*(\\.\\d{2})?$"
    },
    
    "final_acceptance_date": {
      "description": "Latest signature date from RPA Page 16 or final counter offer",
      "type": "string",
      "pattern": "^(0[1-9]|1[0-2])\\/(0[1-9]|[12]\\d|3[01])\\/\\d{4}$"
    },
    
    "contingencies": {
      "description": "Section L on RPA Page 2",
      "type": "object",
      "properties": {
        "loan_days": {
          "description": "L(1) - Column 4 has days, Column 5 has waiver checkbox. Null if waived.",
          "type": ["integer", "null"],
          "default": 17
        },
        "appraisal_days": {
          "description": "L(2) - Column 4 has days, Column 5 has waiver checkbox. Null if waived.",
          "type": ["integer", "null"],
          "default": 17
        },
        "investigation_days": {
          "description": "L(3) - Column 4 only (no waiver checkbox for this one)",
          "type": ["integer", "null"],
          "default": 17
        },
        "crb_attached_and_signed": {
          "description": "L(8) - Checkbox in Column 5 (multi-row span)",
          "type": "boolean"
        }
      }
    },
    
    "cop_contingency": {
      "description": "Section L(9) - Contingency for Sale of Buyer's Property. Checkbox in Columns 3+5 (combined cell). If checked, timelines start when this contingency is removed.",
      "type": "boolean"
    },
    
    "seller_delivery_of_documents_days": {
      "description": "Section N(1), Column 4 - Default 7 if not specified",
      "type": "integer",
      "default": 7
    },
    
    "counters": {
      "description": "Counter offer tracking and merge logic",
      "type": "object",
      "properties": {
        "has_counter_or_addendum": {
          "type": "boolean"
        },
        "counter_chain": {
          "description": "Sequence of documents (e.g., ['RPA', 'SCO #1', 'BCO #1'])",
          "type": "array",
          "items": { "type": "string" },
          "default": ["RPA"]
        },
        "final_version_page": {
          "description": "PDF page number where final acceptance signature appears",
          "type": ["integer", "null"]
        },
        "summary": {
          "description": "Human-readable summary of counter chain",
          "type": "string"
        }
      },
      "required": ["has_counter_or_addendum"]
    },
    
    "home_warranty": {
      "description": "Section 3.Q(18) on RPA Page 3",
      "type": "object",
      "properties": {
        "ordered_by": {
          "description": "Columns 4+5 (combined cell) - Who pays",
          "type": "string",
          "enum": ["Buyer", "Seller", "Both", "Waived"]
        },
        "seller_max_cost": {
          "description": "Right side of combined cell",
          "type": ["string", "null"],
          "pattern": "^\\$\\d{1,3}(,\\d{3})*(\\.\\d{2})?$"
        }
      },
      "required": ["ordered_by"]
    },
    
    "buyers_broker": {
      "description": "RPA Page 17 - REAL ESTATE BROKERS section",
      "type": "object",
      "properties": {
        "brokerage_name": { "type": ["string", "null"] },
        "agent_name": { "type": ["string", "null"] },
        "email": { "type": ["string", "null"] },
        "phone": { "type": ["string", "null"] }
      }
    },
    
    "sellers_broker": {
      "description": "RPA Page 17 - REAL ESTATE BROKERS section",
      "type": "object",
      "properties": {
        "brokerage_name": { "type": ["string", "null"] },
        "agent_name": { "type": ["string", "null"] },
        "email": { "type": ["string", "null"] },
        "phone": { "type": ["string", "null"] }
      }
    }
  },
  "required": [
    "buyer_names",
    "property_address",
    "purchase_price",
    "final_acceptance_date",
    "contingencies"
  ],
  "additionalProperties": false
}