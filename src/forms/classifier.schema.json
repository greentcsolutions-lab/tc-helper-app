{
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "description": "Optional classifier version (for auditing), e.g. 'llm-v1' or 'heuristic-3.7.0'"
    },
    "classificationSource": {
      "type": "string",
      "enum": ["heuristic", "llm", "combined"],
      "description": "Indicates whether the classification came from heuristics, an LLM, or a merged result"
    },
    "state": {
      "type": ["string", "null"],
      "pattern": "^[A-Z]{2}$",
      "description": "Two-letter state code if confidently detected (e.g., 'CA', 'TX'). Null if unknown. Pattern enforces two uppercase letters when present."
    },
    "pageCount": {
      "type": "integer",
      "minimum": 1,
      "description": "Total number of pages in the document. Should match the length of the 'pages' array; enforce equality in code-level validation."
    },
    "pages": {
      "type": "array",
      "minItems": 1,
      "maxItems": 200,
      "description": "Exactly one entry per image/page, in the same order as in the PDF. Length should match pageCount.",
      "items": {
        "oneOf": [
          {
            "type": "null",
            "description": "No recognizable standard form or key content"
          },
          {
            "type": "object",
            "properties": {
              "pdfPage": {
                "type": "integer",
                "minimum": 1
              },
              "state": {
                "type": ["string", "null"],
                "pattern": "^[A-Z]{2}$",
                "description": "Two-letter state code for this page if detectable, or null."
              },
              "formCode": {
                "type": ["string", "null"],
                "description": "Short code identifying the form (e.g., 'RPA', 'TREC 20-16') or null if not determinable"
              },
              "formRevision": {
                "type": ["string", "null"],
                "description": "Form revision date/text as visible on document. Examples: '6/25', '11/2023', '12/15'"
              },
              "formPage": {
                "type": ["integer", "null"],
                "description": "Current page number within this specific form (e.g., page 3 of a 17-page contract)"
              },
              "totalPagesInForm": {
                "type": ["integer", "null"],
                "description": "Total pages in this specific form (e.g., 17 for CA RPA, 9 for TREC 20-16)"
              },
              "role": {
                "type": "string",
                "enum": [
                  "main_contract",
                  "counter_offer",
                  "addendum",
                  "local_addendum",
                  "contingency_release",
                  "disclosure",
                  "financing",
                  "broker_info",
                  "title_page",
                  "other"
                ],
                "description": "Document type classification: main_contract = primary purchase/sales agreement; counter_offer = any counter offer; addendum = general addendum/amendment; local_addendum = state/region-specific addendum; contingency_release = forms that release/modify contingencies (APR, RR, amendments); disclosure = disclosure forms; financing = lender documents; broker_info = standalone broker representation forms NOT part of main contract; title_page = cover pages; other = unknown/misc"
              },
              "titleSnippet": {
                "type": ["string", "null"],
                "maxLength": 120,
                "description": "Prominent header/title text from the page (short snippet)"
              },
              "confidence": {
                "type": "integer",
                "minimum": 0,
                "maximum": 100,
                "description": "Classification confidence (0-100)"
              },
              "contentCategory": {
                "type": "string",
                "enum": [
                  "transaction_terms",
                  "signatures",
                  "broker_info",
                  "disclosures",
                  "boilerplate",
                  "other"
                ],
                "description": "Primary content type based on MAIN BODY content (ignore headers/footers)."
              },
              "hasFilledFields": {
                "type": "boolean",
                "description": "True if the MAIN BODY (not headers/footers) has 3+ substantive filled fields or checked boxes."
              }
            },
            "required": ["pdfPage", "role", "confidence", "contentCategory", "hasFilledFields"],
            "additionalProperties": false
          }
        ]
      }
    }
  },
  "required": ["pageCount", "pages"],
  "additionalProperties": false
}